"use strict";(self.webpackChunkreact_native_gesture_handler_docs=self.webpackChunkreact_native_gesture_handler_docs||[]).push([[4837],{1571:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"fundamentals/reanimated-interactions","title":"Integration with Reanimated","description":"GestureDetector will decide whether to use Reanimated to process provided gestures based on their configuration. If any of the callbacks is a worklet and Reanimated is not explicitly turned off, tools provided by the Reanimated will be utilized, bringing the ability to handle gestures synchronously on the main thread.","source":"@site/docs/fundamentals/reanimated-interactions.mdx","sourceDirName":"fundamentals","slug":"/fundamentals/reanimated-interactions","permalink":"/react-native-gesture-handler/docs/fundamentals/reanimated-interactions","draft":false,"unlisted":false,"editUrl":"https://github.com/software-mansion/react-native-gesture-handler/edit/main/docs/docs/fundamentals/reanimated-interactions.mdx","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"id":"reanimated-interactions","title":"Integration with Reanimated","sidebar_label":"Integration with Reanimated","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Gesture detectors","permalink":"/react-native-gesture-handler/docs/fundamentals/gesture-detectors"},"next":{"title":"Integration with Animated","permalink":"/react-native-gesture-handler/docs/fundamentals/animated-interactions"}}');var s=t(4848),i=t(8453),r=t(2800);const l={id:"reanimated-interactions",title:"Integration with Reanimated",sidebar_label:"Integration with Reanimated",sidebar_position:4},o=void 0,c={},d=[{value:"Automatic workletization of gesture callbacks",id:"automatic-workletization-of-gesture-callbacks",level:2},{value:"Using SharedValue in gesture config",id:"using-sharedvalue-in-gesture-config",level:2},{value:"Disabling Reanimated",id:"disabling-reanimated",level:2},{value:"disableReanimated",id:"disablereanimated",level:3},{value:"runOnJS",id:"runonjs",level:3}];function u(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"GestureDetector"})," will decide whether to use ",(0,s.jsx)(n.a,{href:"https://docs.swmansion.com/react-native-reanimated/",children:"Reanimated"})," to process provided gestures based on their configuration. If any of the callbacks is a ",(0,s.jsx)(n.a,{href:"https://docs.swmansion.com/react-native-reanimated/docs/fundamentals/glossary/#worklet",children:"worklet"})," and Reanimated is not explicitly ",(0,s.jsx)(n.a,{href:"#disabling-reanimated",children:"turned off"}),", tools provided by the Reanimated will be utilized, bringing the ability to handle gestures synchronously on the main thread."]}),"\n",(0,s.jsxs)(n.h2,{id:"automatic-workletization-of-gesture-callbacks",children:["Automatic ",(0,s.jsx)(n.a,{href:"https://docs.swmansion.com/react-native-reanimated/docs/fundamentals/glossary/#to-workletize",children:"workletization"})," of gesture callbacks"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://docs.swmansion.com/react-native-worklets/docs/worklets-babel-plugin/about",children:"Worklets' Babel plugin"})," is setup in a way that automatically marks callbacks passed to gestures in the configuration chain as worklets. This means that you don't need to add a ",(0,s.jsx)(n.code,{children:"'worklet';"})," directive at the beginning of the functions. Here is an example that will be automatically workletized:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsx",children:"const gesture = useTapGesture({\n  onBegin: () => {\n    console.log(_WORKLET);\n  },\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"And here is one that won't:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsx",children:"const callback = () => {\n  console.log(_WORKLET);\n};\n\nconst gesture = useTapGesture({\n  onBegin: callback,\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:["It also won't work when wrapped with hooks like ",(0,s.jsx)(n.code,{children:"useCallback"})," or ",(0,s.jsx)(n.code,{children:"useMemo"}),", e.g:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsx",children:"const callback = useCallback(() => {\n  console.log(_WORKLET);\n}, []);\n\nconst gesture = useTapGesture({\n  onBegin: callback,\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:["In the above cases, you should add a ",(0,s.jsx)(n.code,{children:'"worklet";'})," directive at the beginning of the callbacks, like so:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsx",children:"const callback = () => {\n  // highlight-next-line\n  'worklet';\n  console.log(_WORKLET);\n};\n\nconst gesture = useTapGesture({\n  onBegin: callback,\n});\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsx",children:"const callback = useCallback(() => {\n  // highlight-next-line\n  'worklet;';\n  console.log(_WORKLET);\n}, []);\n\nconst gesture = useTapGesture({\n  onBegin: callback,\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"using-sharedvalue-in-gesture-config",children:"Using SharedValue in gesture config"}),"\n",(0,s.jsxs)(n.p,{children:["RNGH3 allows to pass ",(0,s.jsx)(n.a,{href:"https://docs.swmansion.com/react-native-reanimated/docs/fundamentals/glossary#shared-value",children:(0,s.jsx)(n.code,{children:"SharedValue"})})," to gestures' configurations. This allows to react to configuration changes without unnecessary rerenders."]}),"\n",(0,s.jsx)(r.A,{label:"Show full example",expandedLabel:"Hide full example",lineBounds:[10,19],src:"\nimport * as React from 'react';\nimport { Animated } from 'react-native';\nimport {\nGestureHandlerRootView,\nGestureDetector,\nuseTapGesture,\n} from 'react-native-gesture-handler';\nimport { useSharedValue } from 'react-native-reanimated';\n\nexport default function App() {\n// highlight-next-line\nconst taps = useSharedValue(2);\n\nconst gesture = useTapGesture({\n  // highlight-next-line\n  numberOfTaps: taps,\n  onDeactivate: () => {\n    taps.value += 1;\n  },\n});\n\nreturn (\n  <GestureHandlerRootView>\n    <GestureDetector gesture={gesture}>\n      <Animated.View\n        style={{\n          width: 150,\n          height: 150,\n          backgroundColor: 'blue',\n        }}\n      />\n    </GestureDetector>\n  </GestureHandlerRootView>\n);\n}\n"}),"\n",(0,s.jsx)(n.h2,{id:"disabling-reanimated",children:"Disabling Reanimated"}),"\n",(0,s.jsxs)(n.p,{children:["Gestures created with the hook API have ",(0,s.jsx)(n.code,{children:"Reanimated"})," integration enabled by default, meaning all callbacks are executed on the UI thread. There are two methods available to disable this behavior for a specific gesture."]}),"\n",(0,s.jsx)(n.h3,{id:"disablereanimated",children:"disableReanimated"}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"disableReanimated"})," is set to ",(0,s.jsx)(n.code,{children:"true"})," in the gesture configuration, ",(0,s.jsx)(n.code,{children:"Reanimated"})," integration will be completely turned off for that gesture throughout its entire lifecycle. This setting eliminates all interaction points with ",(0,s.jsx)(n.code,{children:"Reanimated"}),", thereby reducing any potential overhead. Default value for this property is ",(0,s.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"This property cannot be changed dynamically during the gesture's lifecycle."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsx",children:"const gesture = usePanGesture({\n  // highlight-next-line\n  disableReanimated: true,\n\n  onUpdate: () => {\n    console.log('Panning');\n  },\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"runonjs",children:"runOnJS"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"runOnJS"})," property allows you to dynamically control whether callbacks are executed on the JS thread or the UI thread. When set to ",(0,s.jsx)(n.code,{children:"true"}),", callbacks will run on the JS thread. Setting it to ",(0,s.jsx)(n.code,{children:"false"})," will execute them on the UI thread. Default value for this property is ",(0,s.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"This property can be changed dynamically throughout the gesture's lifecycle."}),"\n",(0,s.jsx)(r.A,{label:"Show full example",expandedLabel:"Hide full example",lineBounds:[9,37],src:"\nimport React from 'react';\nimport { View, StyleSheet, Animated } from 'react-native';\nimport {\nGestureDetector,\nGestureHandlerRootView,\nusePanGesture,\n} from 'react-native-gesture-handler';\nimport { useSharedValue } from 'react-native-reanimated';\n\nexport default function App() {\n// highlight-next-line\nconst shouldRunOnJS = useSharedValue(false);\n\nconst panGesture = usePanGesture({\n  onUpdate: () => {\n    console.log(\n      globalThis.__RUNTIME_KIND === 2\n        ? 'Running on UI thread'\n        : 'Running on JS thread'\n    );\n  },\n  onDeactivate: () => {\n    shouldRunOnJS.value = !shouldRunOnJS.value;\n  },\n  // highlight-next-line\n  runOnJS: shouldRunOnJS,\n});\n\nreturn (\n  <GestureHandlerRootView style={styles.container}>\n    <View style={styles.outerBox}>\n      <GestureDetector gesture={panGesture}>\n        <Animated.View style={styles.innerBox} />\n      </GestureDetector>\n    </View>\n  </GestureHandlerRootView>\n);\n}\n\nconst styles = StyleSheet.create({\ncontainer: {\n  flex: 1,\n  alignItems: 'center',\n  justifyContent: 'center',\n},\nouterBox: {\n  backgroundColor: '#b58df1',\n  width: 150,\n  height: 150,\n},\ninnerBox: {\n  width: 100,\n  height: 100,\n  backgroundColor: 'blue',\n},\n});\n"})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},2800:(e,n,t)=>{t.d(n,{A:()=>w});var a=t(6540),s=t(8069);const i={container:"container_oGcb",collapseButton:"collapseButton_YVdr"},r="collapseButton_X7H2",l="arrow_XdVJ";var o;function c(){return c=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)({}).hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},c.apply(null,arguments)}const d=({title:e,titleId:n,...t})=>a.createElement("svg",c({xmlns:"http://www.w3.org/2000/svg",width:12,height:7,fill:"none",viewBox:"0 0 12 7","aria-labelledby":n},t),e?a.createElement("title",{id:n},e):null,o||(o=a.createElement("path",{stroke:"#001A72",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"m1 1 5 5 5-5"})));var u;function h(){return h=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)({}).hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},h.apply(null,arguments)}const g=({title:e,titleId:n,...t})=>a.createElement("svg",h({xmlns:"http://www.w3.org/2000/svg",width:12,height:7,fill:"none",viewBox:"0 0 12 7","aria-labelledby":n},t),e?a.createElement("title",{id:n},e):null,u||(u=a.createElement("path",{stroke:"#F8F9FF",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"m1 1 5 5 5-5"})));var m=t(8532),p=t(4164),x=t(4848);const f=({label:e,expandedLabel:n,collapsed:t,onCollapse:a,className:s})=>{const{colorMode:i}=(0,m.G)();return(0,x.jsxs)("div",{className:(0,p.A)(r,s),"data-collapsed":t,onClick:()=>a(),children:["light"===i?(0,x.jsx)(d,{className:l}):(0,x.jsx)(g,{className:l}),(0,x.jsx)("button",{type:"button",children:t?e:n})]})};var b=t(9146);function w({src:e,label:n,expandedLabel:t,lineBounds:r}){const[l,o]=(0,a.useState)(!0),c=(0,b.A)(e);if(!r)return(0,x.jsx)(s.A,{language:"tsx",children:c});const[d,u]=r,h=c.split("\n").slice(d,u+1).join("\n");return(0,x.jsxs)("div",{className:i.container,children:[(0,x.jsx)(f,{label:n,expandedLabel:t,collapsed:l,onCollapse:()=>o(!l),className:i.collapseButton}),(0,x.jsx)(s.A,{language:"tsx",children:l?h:c})]})}},9146:(e,n,t)=>{t.d(n,{A:()=>o});var a=t(6540),s=t(8463),i=t(2396),r=t(6745);const l={parser:"typescript",plugins:[i.A,r.Ay]};function o(e){const[n,t]=(0,a.useState)(e);return(0,a.useEffect)((()=>{!async function(){try{const n=await s.GP(e,l);t(n)}catch{t(e)}}()}),[e]),n}}}]);