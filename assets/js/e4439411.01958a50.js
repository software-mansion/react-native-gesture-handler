"use strict";(self.webpackChunkreact_native_gesture_handler_docs=self.webpackChunkreact_native_gesture_handler_docs||[]).push([[7118],{1331:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"guides/testing","title":"Testing with Jest","description":"Mocking native modules","source":"@site/docs/guides/testing.md","sourceDirName":"guides","slug":"/guides/testing","permalink":"/react-native-gesture-handler/docs/guides/testing","draft":false,"unlisted":false,"editUrl":"https://github.com/software-mansion/react-native-gesture-handler/edit/main/packages/docs-gesture-handler/docs/guides/testing.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"id":"testing","title":"Testing with Jest","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Troubleshooting","permalink":"/react-native-gesture-handler/docs/guides/troubleshooting"},"next":{"title":"Custom swipeable components inside ScrollView (web)","permalink":"/react-native-gesture-handler/docs/guides/swipe-and-scroll"}}');var i=n(4848),d=n(8453);const a={id:"testing",title:"Testing with Jest",sidebar_position:4},r=void 0,l={},c=[{value:"Mocking native modules",id:"mocking-native-modules",level:2},{value:"Testing Gestures&#39; and Gesture handlers&#39; callbacks",id:"testing-gestures-and-gesture-handlers-callbacks",level:2},{value:"fireGestureHandler",id:"firegesturehandler",level:3},{value:"getByGestureTestId",id:"getbygesturetestid",level:3},{value:"Example",id:"example",level:2}];function o(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"mocking-native-modules",children:"Mocking native modules"}),"\n",(0,i.jsxs)(t.p,{children:["In order to load mocks provided by RNGH add following to your jest config in ",(0,i.jsx)(t.code,{children:"package.json"}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-json",children:'"setupFiles": ["./node_modules/react-native-gesture-handler/jestSetup.js"]\n'})}),"\n",(0,i.jsx)(t.p,{children:"Example:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-json",children:'"jest": {\n  "preset": "react-native",\n  "setupFiles": ["./node_modules/react-native-gesture-handler/jestSetup.js"]\n}\n'})}),"\n",(0,i.jsx)(t.h2,{id:"testing-gestures-and-gesture-handlers-callbacks",children:"Testing Gestures' and Gesture handlers' callbacks"}),"\n",(0,i.jsxs)(t.p,{children:["RNGH provides APIs, specifically ",(0,i.jsx)(t.a,{href:"#firegesturehandler",children:(0,i.jsx)(t.code,{children:"fireGestureHandler"})})," and ",(0,i.jsx)(t.a,{href:"#getbygesturetestid",children:(0,i.jsx)(t.code,{children:"getByGestureTestId"})}),", to trigger selected handlers."]}),"\n",(0,i.jsx)(t.h3,{id:"firegesturehandler",children:"fireGestureHandler"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-ts",children:"fireGestureHandler: (componentOrGesture, eventList) => void;\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Simulates one event stream (i.e. event sequence starting with ",(0,i.jsx)(t.code,{children:"BEGIN"})," state and ending\nwith one of ",(0,i.jsx)(t.code,{children:"END"}),"/",(0,i.jsx)(t.code,{children:"FAIL"}),"/",(0,i.jsx)(t.code,{children:"CANCEL"})," states), calling appropriate callbacks associated with given gesture handler."]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"componentOrGesture"})," - Either Gesture Handler component found by ",(0,i.jsx)(t.code,{children:"Jest"})," queries (e.g. ",(0,i.jsx)(t.code,{children:"getByTestId"}),") or Gesture found by ",(0,i.jsx)(t.a,{href:"#getbygesturetestidtestid",children:(0,i.jsx)(t.code,{children:"getByGestureTestId()"})})]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"eventList"})," - Event data passed to appropriate callback. RNGH fills event list if required\ndata is missing using these rules:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"oldState"})," is filled using state of the previous event. ",(0,i.jsx)(t.code,{children:"BEGIN"})," events use\n",(0,i.jsx)(t.code,{children:"UNDETERMINED"})," value as previous event."]}),"\n",(0,i.jsxs)(t.li,{children:["Events after first ",(0,i.jsx)(t.code,{children:"ACTIVE"})," state can omit ",(0,i.jsx)(t.code,{children:"state"})," field."]}),"\n",(0,i.jsxs)(t.li,{children:["Handler specific data is filled (e.g. ",(0,i.jsx)(t.code,{children:"numberOfTouches"}),", ",(0,i.jsx)(t.code,{children:"x"})," fields) with\ndefaults."]}),"\n",(0,i.jsxs)(t.li,{children:["Missing ",(0,i.jsx)(t.code,{children:"BEGIN"})," and ",(0,i.jsx)(t.code,{children:"END"})," events are added with data copied from first and last\npassed event, respectively."]}),"\n",(0,i.jsxs)(t.li,{children:["If first event doesn't have ",(0,i.jsx)(t.code,{children:"state"})," field, the ",(0,i.jsx)(t.code,{children:"ACTIVE"})," state is assumed."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Some ",(0,i.jsx)(t.code,{children:"eventList"})," examples:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-jsx",children:"const oldStateFilled = [\n  { state: State.BEGAN },\n  { state: State.ACTIVE },\n  { state: State.END },\n]; // three events with specified state are fired.\n\nconst implicitActiveState = [\n  { state: State.BEGAN },\n  { state: State.ACTIVE },\n  { x: 5 },\n  { state: State.END },\n]; // 4 events, including two ACTIVE events (second one has overridden additional data).\n\nconst implicitBegin = [\n  { x: 1, y: 11 },\n  { x: 2, y: 12, state: State.FAILED },\n]; // 3 events, including implicit BEGAN, one ACTIVE, and one FAILED event with additional data.\n\nconst implicitBeginAndEnd = [\n  { x: 5, y: 15 },\n  { x: 6, y: 16 },\n  { x: 7, y: 17 },\n]; // 5 events, including 3 ACTIVE events and implicit BEGAN and END events. BEGAN uses first event's additional data, END uses last event's additional data.\n\nconst allImplicits = []; // 3 events, one BEGIN, one ACTIVE, one END with defaults.\n"})}),"\n",(0,i.jsx)(t.h3,{id:"getbygesturetestid",children:"getByGestureTestId"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-tsx",children:"getByGestureTestId: (testID: string) => Gesture;\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Returns opaque data type associated with gesture. Gesture is found via ",(0,i.jsx)(t.a,{href:"/docs/gestures/use-pan-gesture#testid",children:(0,i.jsx)(t.code,{children:"testID"})})," attribute in rendered\ncomponents."]}),"\n",(0,i.jsx)(t.admonition,{type:"warning",children:(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"testID"})," must be unique among components rendered in test."]})}),"\n",(0,i.jsx)(t.h2,{id:"example",children:"Example"}),"\n",(0,i.jsxs)(t.p,{children:["Extracted from RNGH tests, check ",(0,i.jsx)(t.a,{href:"https://github.com/software-mansion/react-native-gesture-handler/blob/main/packages/react-native-gesture-handler/src/__tests__/api_v3.test.tsx",children:(0,i.jsx)(t.code,{children:"api_v3.test.tsx"})})," for full implementation."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-tsx",children:"test('Pan gesture', () => {\n  const onBegin = jest.fn();\n  const onStart = jest.fn();\n\n  const panGesture = renderHook(() =>\n    usePanGesture({\n      disableReanimated: true,\n      onBegin: (e) => onBegin(e),\n      onActivate: (e) => onStart(e),\n    })\n  ).result.current;\n\n  fireGestureHandler(panGesture, [\n    { oldState: State.UNDETERMINED, state: State.BEGAN },\n    { oldState: State.BEGAN, state: State.ACTIVE },\n    { oldState: State.ACTIVE, state: State.ACTIVE },\n    { oldState: State.ACTIVE, state: State.END },\n  ]);\n\n  expect(onBegin).toHaveBeenCalledTimes(1);\n  expect(onStart).toHaveBeenCalledTimes(1);\n});\n"})})]})}function u(e={}){const{wrapper:t}={...(0,d.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>r});var s=n(6540);const i={},d=s.createContext(i);function a(e){const t=s.useContext(d);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(d.Provider,{value:t},e.children)}}}]);