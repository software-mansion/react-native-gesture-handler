
/**
 * This code was generated by
 * [react-native-codegen](https://www.npmjs.com/package/react-native-codegen).
 *
 * Do not edit this file as changes may cause incorrect behavior and will be
 * lost once the code is regenerated.
 *
 * @generated by codegen project: GenerateShadowNodeCpp.js
 */

#include "RNGestureHandlerDetectorShadowNode.h"

namespace facebook::react {

extern const char RNGestureHandlerDetectorComponentName[] =
    "RNGestureHandlerDetector";

void RNGestureHandlerDetectorShadowNode::initialize() {
  // Disable forcing view flattening
  ShadowNode::traits_.unset(ShadowNodeTraits::ForceFlattenView);

  // When the detector is cloned and has a child node, the child node should be
  // cloned as well to ensure it is mutable.
  const auto &children = getChildren();
  if (!children.empty()) {
    react_native_assert(
        children.size() == 1 &&
        "RNGestureHandlerDetector received more than one child");

    const auto clonedChild = children[0]->clone({});
    replaceChild(*children[0], clonedChild);
  }
}

void RNGestureHandlerDetectorShadowNode::layout(LayoutContext layoutContext) {
  // TODO: consider allowing more than one child and doing bounding box
  react_native_assert(getChildren().size() == 1);

  auto child = std::static_pointer_cast<const YogaLayoutableShadowNode>(
      getChildren()[0]);
  auto childWithProtectedAccess =
      std::static_pointer_cast<const RNGestureHandlerDetectorShadowNode>(child);

  auto shouldSkipCustomLayout =
      !childWithProtectedAccess->yogaNode_.getHasNewLayout();

  // Do default layout after reading the new layout flag from the child.
  // Default layout will reset the flag on the child nodes.
  YogaLayoutableShadowNode::layout(layoutContext);

  // The child node did not have its layout changed, we can reuse previous
  // values
  if (shouldSkipCustomLayout) {
    react_native_assert(previousLayoutMetrics_.has_value());
    setLayoutMetrics(previousLayoutMetrics_.value());
    return;
  }

  child->ensureUnsealed();
  auto mutableChild = std::const_pointer_cast<YogaLayoutableShadowNode>(child);

  auto metrics = child->getLayoutMetrics();
  setLayoutMetrics(metrics);

  auto childmetrics = child->getLayoutMetrics();
  childmetrics.frame.origin = Point{};
  mutableChild->setLayoutMetrics(childmetrics);
}

} // namespace facebook::react
